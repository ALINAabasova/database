PS C:\Users\Admin>  psql -h localhost -p 5432 -U postgres -d postgres
Password for user postgres:

psql (17.6, server 16.2)
WARNING: Console code page (866) differs from Windows code page (1251)
         8-bit characters might not work correctly. See psql reference
         page "Notes for Windows users" for details.
Type "help" for help.

postgres=# CREATE TABLE accounts (
postgres(#     account_id SERIAL PRIMARY KEY,
postgres(#     balance DECIMAL(10,2)
postgres(# );
CREATE TABLE
postgres=#
postgres=# CREATE TABLE customers (
postgres(#     customer_id SERIAL PRIMARY KEY,
postgres(#     name VARCHAR(100),
postgres(#     email VARCHAR(100)
postgres(# );
CREATE TABLE
postgres=#
postgres=# CREATE TABLE orders (
postgres(#     order_id SERIAL PRIMARY KEY,
postgres(#     customer_id INTEGER REFERENCES customers(customer_id),
postgres(#     total DECIMAL(10,2)
postgres(# );
CREATE TABLE
postgres=#
postgres=# CREATE TABLE order_items (
postgres(#     order_item_id SERIAL PRIMARY KEY,
postgres(#     order_id INTEGER REFERENCES orders(order_id),
postgres(#     product_id INTEGER,
postgres(#     quantity INTEGER
postgres(# );
CREATE TABLE
postgres=#
postgres=# CREATE TABLE inventory (
postgres(#     product_id INTEGER PRIMARY KEY,
postgres(#     stock INTEGER
postgres(# );
CREATE TABLE
postgres=#
postgres=# CREATE TABLE products (
postgres(#     product_id SERIAL PRIMARY KEY,
postgres(#     name VARCHAR(100),
postgres(#     price DECIMAL(10,2)
postgres(# );
CREATE TABLE
postgres=#
postgres=# CREATE TABLE logs (
postgres(#     log_id SERIAL PRIMARY KEY,
postgres(#     message TEXT
postgres(# );
CREATE TABLE
postgres=#
postgres=# CREATE TABLE audit_log (
postgres(#     log_id SERIAL PRIMARY KEY,
postgres(#     action VARCHAR(100),
postgres(#     timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
postgres(# );
CREATE TABLE
postgres=#
postgres=# CREATE TABLE users (
postgres(#     user_id SERIAL PRIMARY KEY,
postgres(#     name VARCHAR(100),
postgres(#     email VARCHAR(100)
postgres(# );
CREATE TABLE
postgres=#
postgres=# CREATE TABLE user_preferences (
postgres(#     preference_id SERIAL PRIMARY KEY,
postgres(#     user_id INTEGER REFERENCES users(user_id),
postgres(#     theme VARCHAR(50)
postgres(# );
CREATE TABLE
postgres=#
postgres=# INSERT INTO accounts (balance) VALUES (1000.00), (500.00);
INSERT 0 2
postgres=# INSERT INTO inventory (product_id, stock) VALUES (101, 50), (102, 30);
INSERT 0 2
postgres=# INSERT INTO customers (name, email) VALUES ('Initial Customer', 'initial@email.com');
INSERT 0 1
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;
UPDATE 1
postgres=*# UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;
UPDATE 1
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;
UPDATE 1
postgres=*# UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;
UPDATE 1
postgres=*# ROLLBACK;
ROLLBACK
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# SELECT balance FROM accounts WHERE account_id = 1;
 balance
---------
  900.00
(1 row)


postgres=*# UPDATE accounts SET balance = balance - 500 WHERE account_id = 1;
UPDATE 1
postgres=*# UPDATE accounts SET balance = balance + 500 WHERE account_id = 2;
UPDATE 1
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# INSERT INTO orders (customer_id, total) VALUES (1, 250.00);
INSERT 0 1
postgres=*# INSERT INTO order_items (order_id, product_id, quantity) VALUES (1, 101, 2);
INSERT 0 1
postgres=*# UPDATE inventory SET stock = stock - 2 WHERE product_id = 101;
UPDATE 1
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# INSERT INTO customers (name, email) VALUES ('John Doe', 'john@email.com');
INSERT 0 1
postgres=*# INSERT INTO orders (customer_id, total) VALUES (1, 100.00);
INSERT 0 1
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
BEGIN
postgres=*# SELECT * FROM accounts WHERE balance > 1000;
 account_id | balance
------------+---------
          2 | 1100.00
(1 row)


postgres=*# SELECT * FROM accounts WHERE balance > 1000;
 account_id | balance
------------+---------
          2 | 1100.00
(1 row)


postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
BEGIN
postgres=*# SELECT * FROM accounts WHERE balance > 1000;
 account_id | balance
------------+---------
          2 | 1100.00
(1 row)


postgres=*# SELECT * FROM accounts WHERE balance > 1000;
 account_id | balance
------------+---------
          2 | 1100.00
(1 row)


postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
BEGIN
postgres=*# SELECT * FROM accounts;
 account_id | balance
------------+---------
          1 |  400.00
          2 | 1100.00
(2 rows)


postgres=*# UPDATE accounts SET balance = balance * 1.05;
UPDATE 2
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
SET
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# INSERT INTO customers (name, email) VALUES ('Alice', 'alice@email.com');
INSERT 0 1
postgres=*# SAVEPOINT after_customer_insert;
SAVEPOINT
postgres=*# INSERT INTO orders (customer_id, total) VALUES (2, 500.00);
INSERT 0 1
postgres=*# ROLLBACK TO SAVEPOINT after_customer_insert;
ROLLBACK
postgres=*# INSERT INTO orders (customer_id, total) VALUES (2, 300.00);
INSERT 0 1
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# INSERT INTO products (name, price) VALUES ('Laptop', 999.99);
INSERT 0 1
postgres=*# SAVEPOINT sp1;
SAVEPOINT
postgres=*# INSERT INTO products (name, price) VALUES ('Mouse', 25.99);
INSERT 0 1
postgres=*# SAVEPOINT sp2;
SAVEPOINT
postgres=*# INSERT INTO products (name, price) VALUES ('Invalid Product', -50.00);
INSERT 0 1
postgres=*# ROLLBACK TO SAVEPOINT sp2;
ROLLBACK
postgres=*# INSERT INTO products (name, price) VALUES ('Keyboard', 79.99);
INSERT 0 1
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# INSERT INTO logs (message) VALUES ('Starting process');
INSERT 0 1
postgres=*# SAVEPOINT process_start;
SAVEPOINT
postgres=*# INSERT INTO logs (message) VALUES ('Process completed');
INSERT 0 1
postgres=*# RELEASE SAVEPOINT process_start;
RELEASE
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# UPDATE inventory SET stock = stock - 1 WHERE product_id = 101;
UPDATE 1
postgres=*# INSERT INTO orders (customer_id, total) VALUES (1, 150.00);
INSERT 0 1
postgres=*# INSERT INTO order_items (order_id, product_id, quantity) VALUES (3, 101, 1);
ОШИБКА:  INSERT или UPDATE в таблице "order_items" нарушает ограничение внешнего ключа "order_items_order_id_fkey"
DETAIL:  Ключ (order_id)=(3) отсутствует в таблице "orders".
postgres=!# COMMIT;
ROLLBACK
postgres=#
postgres=# DO $$
postgres$# DECLARE
postgres$#     current_balance DECIMAL;
postgres$# BEGIN
postgres$#     SELECT balance INTO current_balance FROM accounts WHERE account_id = 1;
postgres$#
postgres$#     IF current_balance < 100 THEN
postgres$#         RAISE NOTICE 'Transaction failed: Insufficient funds';
postgres$#     ELSE
postgres$#         BEGIN;
postgres$#         UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;
postgres$#         UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;
postgres$#         COMMIT;
postgres$#     END IF;
postgres$# END $$;
ОШИБКА:  ошибка синтаксиса (примерное положение: ";")
LINE 10:         BEGIN;
                      ^
postgres=#
postgres=# BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
BEGIN
postgres=*# UPDATE accounts SET balance = balance * 1.10 WHERE account_id = 1;
UPDATE 1
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
BEGIN
postgres=*# SELECT COUNT(*) FROM orders;
 count
-------
     3
(1 row)


postgres=*# SELECT SUM(total) FROM orders;
  sum
--------
 650.00
(1 row)


postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# INSERT INTO orders (customer_id, total) VALUES (1, 1000.00);
INSERT 0 1
postgres=*# SAVEPOINT before_items;
SAVEPOINT
postgres=*# INSERT INTO order_items (order_id, product_id, quantity) VALUES (4, 101, 2);
INSERT 0 1
postgres=*# INSERT INTO order_items (order_id, product_id, quantity) VALUES (4, 102, 1);
INSERT 0 1
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# SELECT
postgres-#     blocked_locks.pid AS blocked_pid,
postgres-#     blocked_activity.usename AS blocked_user,
postgres-#     blocking_locks.pid AS blocking_pid,
postgres-#     blocking_activity.usename AS blocking_user,
postgres-#     blocked_activity.query AS blocked_statement
postgres-# FROM pg_catalog.pg_locks blocked_locks
postgres-# JOIN pg_catalog.pg_stat_activity blocked_activity ON blocked_activity.pid = blocked_locks.pid
postgres-# JOIN pg_catalog.pg_locks blocking_locks ON blocking_locks.locktype = blocked_locks.locktype
postgres-#     AND blocking_locks.database IS NOT DISTINCT FROM blocked_locks.database
postgres-#     AND blocking_locks.relation IS NOT DISTINCT FROM blocked_locks.relation
postgres-#     AND blocking_locks.page IS NOT DISTINCT FROM blocked_locks.page
postgres-#     AND blocking_locks.tuple IS NOT DISTINCT FROM blocked_locks.tuple
postgres-#     AND blocking_locks.virtualxid IS NOT DISTINCT FROM blocked_locks.virtualxid
postgres-#     AND blocking_locks.transactionid IS NOT DISTINCT FROM blocked_locks.transactionid
postgres-#     AND blocking_locks.classid IS NOT DISTINCT FROM blocked_locks.classid
postgres-#     AND blocking_locks.objid IS NOT DISTINCT FROM blocked_locks.objid
postgres-#     AND blocking_locks.objsubid IS NOT DISTINCT FROM blocked_locks.objsubid
postgres-# JOIN pg_catalog.pg_stat_activity blocking_activity ON blocking_activity.pid = blocking_locks.pid
postgres-# WHERE NOT blocked_locks.granted
postgres-#     AND blocking_locks.granted;
 blocked_pid | blocked_user | blocking_pid | blocking_user | blocked_statement
-------------+--------------+--------------+---------------+-------------------
(0 rows)


postgres=#
postgres=# BEGIN;
BEGIN
postgres=*# INSERT INTO audit_log (action) VALUES ('user_creation');
INSERT 0 1
postgres=*# INSERT INTO users (name, email) VALUES ('John Doe', 'john@example.com');
INSERT 0 1
postgres=*# INSERT INTO user_preferences (user_id, theme) VALUES (1, 'dark');
INSERT 0 1
postgres=*# COMMIT;
COMMIT
postgres=#
postgres=# DROP TABLE user_preferences CASCADE;
DROP TABLE
postgres=# DROP TABLE users CASCADE;
DROP TABLE
postgres=# DROP TABLE audit_log CASCADE;
DROP TABLE
postgres=# DROP TABLE logs CASCADE;
DROP TABLE
postgres=# DROP TABLE products CASCADE;
DROP TABLE
postgres=# DROP TABLE inventory CASCADE;
DROP TABLE
postgres=# DROP TABLE order_items CASCADE;
DROP TABLE
postgres=# DROP TABLE orders CASCADE;
DROP TABLE
postgres=# DROP TABLE customers CASCADE;
DROP TABLE
postgres=# DROP TABLE accounts CASCADE;
DROP TABLE